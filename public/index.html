<html>
<head>
  <title>Bejesus IRC Channel</title>
  <style type="text/css">
    * {
      margin: 0px;
    }
    body, html {
      margin: 0px;
      padding: 0px;
      color: #000;
      background:#a7a09a;
      height: 98%;
    }
    div#top_section {
      min-height: 100%;
      height: auto !important;
      height: 100%;
    }
    div#nick_list {
      float: right;
      width: 150px;
    }
    div#chat_body {
      float: left;
    }
    div#chat_bar .push {
      clear: both;
      height: 2em;
    }
  </style>
  <script src="/socket.io/socket.io.js"></script>
  <script type="text/javascript">
    var sock = null;
    var rv = null;
    var nickname = null;
    var chatBody = null;
    var textInput = null;
    var body_loaded = function () {
      sock = new io.Socket();
      sock.on('message', handleMessage);
      sock.connect();
      chatBody = document.getElementById('chat_body');
      textInput = document.getElementById('text_input');
    };
    var getNickname = function () {
      var name = prompt("Please enter your nickname:", "");
      switch (name) {
        case "":
          alert("You did not input a nickname, please reload if you wish to connect.");
          sock.disconnect();
          return null;
          break;
        case null:
          alert("Login cancelled, please reload if you wish to connect.");
          sock.disconnect();
          return null;
          break;
        default:
          return name;
          break;
      }
    };
    var appendMessage = function (from, message, s) {
      if (typeof s != 'undefined' && s == true) {
        var namewrap = ["<b><i>", "</i></b>"];
      } else {
        var namewrap = ["<b>", "</b>"];
      }
      var p = document.createElement('p');
      p.innerHTML = "<p>" + namewrap[0] + from + namewrap[1] + ": " + message + "</p>";
      chatBody.appendChild(p);
      chatBody.appendChild(document.createElement('br'));
    }
    var handleMessage = function (data) {
      var obj = JSON.parse(data);
      if (nickname === null) {
        var tmp = getNickname();
        if (tmp !== null) {
          nickname = tmp;
          rv = sock.send(JSON.stringify({ nickname: nickname }));
        }
      } else {
        if (obj.hasOwnProperty('messagetype')) {
          switch (obj.messagetype) {
            case "message":
              appendMessage(obj.from, obj.message, false);
              break;
            default:
              alert(data);
              break;
          }
        } else {
          alert(data);
        }
      }
    };
    var sendMessage = function () {
      appendMessage(nickname, textInput.value, true);
      sock.send(JSON.stringify({
        messagetype: "message",
        message: textInput.value
      }));
      textInput.value = "";
    };
    var handleKeyPress = function (e) {
      if (window.event) {
        e = window.event;
      }
      if (e.keyCode == 13) {
        sendMessage();
      }
    }
  </script>
</head>
<body onload="body_loaded();">
  <div id="top_section">
    <div id="nick_list">
      <ol id="nick_ol">
      </ol>
    </div>
    <div id="chat_body">
    </div>
  </div>
  <div id="chat_bar">
    <input type="text" id="text_input" onkeypress="handleKeyPress(event);"></input><button onClick="sendMessage();">Send</button>
  </div>
</body>
</html>